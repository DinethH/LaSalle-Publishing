<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">


<dom-module id="cart-page">
  <template>
    <style>
      :host {
        display: block;
      }

    .container-desktop {
      max-width: 1200px;
      margin: 0 auto;
    }
    .product-image {
      width: 100px;
    }
    
    paper-material {
      margin: 20px;
      padding: 15px;
    }
    
    .product-title {
      font-weight: bold;
      
    }
    .product-details {
      padding-left: 25px;
    }
    .product-price {
      color: #666;
      padding-top: 20px;
    }
    paper-toast {
     --paper-toast-background-color: red;
    }
    
    </style>
    
    <iron-ajax id="cartData" url="https://lasalle-publishing-dinethh.c9users.io/app/scripts/get-cart.php" last-response="{{data}}" auto></iron-ajax>
 
    <iron-ajax id="deleteItem" url$="https://lasalle-publishing-dinethh.c9users.io/app/scripts/cart-delete.php?id={{itemID}}" last-response="{{data2}}"></iron-ajax>


  <div class="container-desktop layout horizontal">

    <div class="flex">
      <template id="cartItems" is="dom-repeat" items="{{data}}">
        <paper-material elevation="1">
          <div class="layout horizontal">
            <div>
              <img class="product-image" src$="https://lasalle-publishing-dinethh.c9users.io/app/images/products/{{item.img}}">
            </div>
            <div class="product-details layout vertical">
              <div class="product-title">
                {{item.name}}
              </div>
              <div class="product-price">
                ${{item.price}}
              </div>
            </div>
            <div class="flex"></div>
            <div>
              <paper-icon-button on-tap="deletItem" id="deleteItemButton" icon="delete"></paper-icon-button>
            </div>
            
            
          </div>
        </paper-material>
      </template>
    </div>
    
    
    <div>
      proceed with payment
    </div>
  </div>
  
  
  <iron-ajax id="countCart" url="https://lasalle-publishing-dinethh.c9users.io/app/scripts/cart-count.php" last-response="{{ccount}}"></iron-ajax>
  
  
  <paper-toast id="deleteCartToast" text="Item has been removed from the cart!"></paper-toast>
   
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'cart-page',

        properties: {
          items: {
            type: Array,
            notify: true,
          },
          ccount: {
            type: String,
            notify: true,
            observer: '_ccountChanged'
          },
          itemID: String,
          data2: {
            observer: '_data2Changed'
          }
        },

        _ccountChanged: function (newValue, oldValue) {
          this.$.cartData.generateRequest(); 
        },
        _data2Changed: function (newValue, oldValue) {
          this.$.countCart.generateRequest();
        },
        deletItem: function(e) {
          var itemIDO = this.$.cartItems.itemForElement(e.target);
          this.itemID = itemIDO.id;
          this.$.deleteItem.generateRequest();
          this.$.deleteItem.generateRequest();
          this.$.deleteCartToast.open();
          
        }
      });
    })();
  </script>
</dom-module>
